device = "pdf",
width = 12,
height = 12,
units = "in",
dpi = 300)
p = phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
ggplot(aes(x = pseudotime,
y = coi)) +
geom_point(alpha = 0.5) +
stat_cor(p.accuracy = 1e-200) +
facet_wrap(.~lineage, scales = "free") +
theme_pubr()
ggsave(filename = paste(workDir,
"/fig/",
"lineage_pseudotimes",
".knn-", this_knn,
".set-", this_set,
".vs-coi",
".pdf",
sep = ""),
plot = p,
device = "pdf",
width = 6,
height = 4,
units = "in",
dpi = 300)
ggsave(filename = paste(workDir,
"/fig/",
"lineage_pseudotimes",
".knn-", this_knn,
".set-", this_set,
".vs-coi",
".pdf",
sep = ""),
plot = p,
device = "pdf",
width = 6*2,
height = 4*2,
units = "in",
dpi = 300)
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% arrange(-coi) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==5) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==9) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==10) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==11) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==12) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==2) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==3) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% arrange(-coi) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==1) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==2) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==3) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==4) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==5) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==6) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==7) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
p = phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 4) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
p
p = phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 5) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
p
p = phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 6) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
p
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 7) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 8) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 9) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 10) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 11) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 12) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>%
filter(lineage == 1) %>%
arrange(coi) %>%
ggplot(aes(x = PHATE1,
y = PHATE2)) +
geom_point(aes(color = pseudotime)) +
geom_path(data = curves %>% arrange(Order),
aes(group = Lineage)) +
scale_x_continuous(limits = c(-0.06,0.06)) +
scale_y_continuous(limits = c(-0.06,0.06)) +
theme_pubr()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==1) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==2) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
phate.all %>%
filter(knn==this_knn) %>%
bind_cols(phate.pseudotimes) %>%
merge(coi, by = "dog") %>%
pivot_longer(cols = colnames(phate.pseudotimes),
names_to = "lineage",
values_to = "pseudotime") %>%
mutate(lineage = as.integer(gsub("Lineage","",lineage))) %>% filter(lineage==3) %>% arrange(-pseudotime) %>% select(dog,purebred,breed,greyhound,coi,pseudotime,lineage) %>% filter(!is.na(pseudotime)) %>% View()
# LIBRARIES ----
## Data Management ----
require(argparse)
require(tidyverse)
require(dplyr)
require(data.table)
require(zoo)
## Visualization and Plotting ----
require(ggpubr)
require(ggtext)
require(ggrepel)
require(scales)
require(cowplot)
require(corrplot)
require(colorspace)
require(viridis)
require(wesanderson)
require(jtools)
require(plotly)
## ARGUMENTS ----
parser <- ArgumentParser()
parser$add_argument("--dir",
help = "Working directory",
default = "~/Dropbox (UMass Medical School)/Projects/DarwinsArk/git/darwins-ark-geno")
parser$add_argument("--dog",
help = "CSV file with Darwin's Ark `dogs` data",
default = "/dat/dog/DarwinsArk_20221120_dogs.csv")
parser$add_argument("--gen",
help = "PLINK .fam file",
default = "/dat/gen/DarwinsArk_gp-0.70_biallelic-snps_maf-0.001_geno-0.05_hwe-1e-20-midp-keep-fewhet_N-3465.fam")
parser$add_argument("--adm",
help = "CSV file with global ancestry results from ADMIXTURE",
default = "/dat/adm/DarwinsArk_gp-0.70_biallelic-snps_maf-0.001_geno-0.05_hwe-1e-20-midp-keep-fewhet_N-3465_global-adm_supervised_K-115.csv")
parser$add_argument("--coi",
help = "CSV file with inbreeding",
default = "/dat/coi/DarwinsArk_2022-11-20_inbreeding.csv")
args <- parser$parse_args()
print(args)
### Set working directory ----
workDir = args$dir
setwd(workDir)
## LOAD DATA ----
dog = read_csv(file = paste(workDir,
args$dog,
sep = ""))
gen = read_tsv(file = paste(workDir,
args$gen,
sep = ""),
col_names = c("fam",
"dog",
"pat",
"mat",
"sex",
"phe"))
adm = read_csv(file = paste(workDir,
args$adm,
sep = ""))
coi = read_csv(file = paste(workDir,
args$coi,
sep = ""))
source("~/Dropbox (UMass Medical School)/Projects/DarwinsArk/git/darwins-ark-geno/bin/coi.R")
# STATS ----
coi %>%
select(dog,coi) %>%
describe() %>%
as.data.table()
# STATS ----
coi %>%
select(coi) %>%
describe() %>%
as.data.table()
View(coi)
source("~/Dropbox (UMass Medical School)/Projects/DarwinsArk/git/darwins-ark-geno/bin/coi.R")
# STATS ----
coi %>%
select(-dog) %>%
describe() %>%
as.data.table()
# STATS ----
coi %>%
select(-dog) %>%
describe() %>%
as.data.table() %>%
mutate(var = colnames(coi)[-1])
source("~/Dropbox (UMass Medical School)/Projects/DarwinsArk/git/darwins-ark-geno/bin/coi.R")
# STATS ----
coi.summary.all = coi %>%
select(-dog) %>%
describe() %>%
as.data.table() %>%
mutate(var = colnames(coi)[-1])
View(coi.summary.all)
-log10(5e-8)
library(tidyverse)
library(data.table)
library(ggpubr)
library(ggrepel)
?map_dfr
